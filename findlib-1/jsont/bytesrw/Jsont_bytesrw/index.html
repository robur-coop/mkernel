<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Jsont_bytesrw (docs.findlib-1.jsont.bytesrw.Jsont_bytesrw)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../../../index.html">Index</a> &#x00BB; <a href="../../../../index.html">docs</a> &#x00BB; <a href="../../../index.html">findlib-1</a> &#x00BB; <a href="../../index.html">jsont</a> &#x00BB; <a href="../index.html">bytesrw</a> &#x00BB; Jsont_bytesrw</nav><header class="odoc-preamble"><h1>Module <code><span>Jsont_bytesrw</span></code></h1><p>JSON codec.</p><p>According to <a href="https://www.rfc-editor.org/rfc/rfc8259">RFC 8259</a>.</p><p>See notes about <a href="#layout" title="layout">layout preservation</a> and behaviour on <a href="#duplicate" title="duplicate">duplicate members</a>.</p><p><b>Tip.</b> For maximal performance decode with <code>~layout:false</code> and <code>~locs:false</code>, this is the default. Howver using <code>~locs:true</code> improves some error reports.</p></header><div class="odoc-tocs"><nav class="odoc-toc odoc-local-toc"><ul><li><a href="#decode">Decode</a></li><li><a href="#encode">Encode</a></li><li><a href="#recode">Recode</a></li><li><a href="#layout">Layout preservation</a></li><li><a href="#duplicate">Duplicate object members</a></li></ul></nav></div><div class="odoc-content"><h2 id="decode"><a href="#decode" class="anchor"></a>Decode</h2><div class="odoc-spec"><div class="spec value anchored" id="val-decode"><a href="#val-decode" class="anchor"></a><code><span><span class="keyword">val</span> decode : 
  <span><span class="optlabel">?layout</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?locs</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?file</span>:<a href="../../Jsont/Textloc/index.html#type-fpath">Jsont.Textloc.fpath</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="../../Jsont/index.html#type-t">Jsont.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../bytesrw/Bytesrw/Bytes/Reader/index.html#type-t">Bytesrw.Bytes.Reader.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, string)</span> <a href="../../../../stdlib/Stdlib/index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>decode t r</code> decodes a value from <code>r</code> according to <code>t</code>.</p><ul><li>If <code>layout</code> is <code>true</code> whitespace is preserved in <a href="../../Jsont/Meta/index.html#type-t"><code>Jsont.Meta.t</code></a> values. Defaults to <code>false</code>.</li><li>If <code>locs</code> is <code>true</code> locations are preserved in <a href="../../Jsont/Meta/index.html#type-t"><code>Jsont.Meta.t</code></a> values and error messages are precisely located. Defaults to <code>false</code>.</li><li><code>file</code> is the file path from which <code>r</code> is assumed to read. Defaults to <a href="../../Jsont/Textloc/index.html#val-file_none"><code>Jsont.Textloc.file_none</code></a></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-decode'"><a href="#val-decode'" class="anchor"></a><code><span><span class="keyword">val</span> decode' : 
  <span><span class="optlabel">?layout</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?locs</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?file</span>:<a href="../../Jsont/Textloc/index.html#type-fpath">Jsont.Textloc.fpath</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="../../Jsont/index.html#type-t">Jsont.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../bytesrw/Bytesrw/Bytes/Reader/index.html#type-t">Bytesrw.Bytes.Reader.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, <a href="../../Jsont/Error/index.html#type-t">Jsont.Error.t</a>)</span> <a href="../../../../stdlib/Stdlib/index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>decode'</code> is like <a href="#val-decode"><code>decode</code></a> but preserves the error structure.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-decode_string"><a href="#val-decode_string" class="anchor"></a><code><span><span class="keyword">val</span> decode_string : 
  <span><span class="optlabel">?layout</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?locs</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?file</span>:<a href="../../Jsont/Textloc/index.html#type-fpath">Jsont.Textloc.fpath</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="../../Jsont/index.html#type-t">Jsont.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, string)</span> <a href="../../../../stdlib/Stdlib/index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>decode_string</code> is like <a href="#val-decode"><code>decode</code></a> but decodes directly from a string.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-decode_string'"><a href="#val-decode_string'" class="anchor"></a><code><span><span class="keyword">val</span> decode_string' : 
  <span><span class="optlabel">?layout</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?locs</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?file</span>:<a href="../../Jsont/Textloc/index.html#type-fpath">Jsont.Textloc.fpath</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="../../Jsont/index.html#type-t">Jsont.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, <a href="../../Jsont/Error/index.html#type-t">Jsont.Error.t</a>)</span> <a href="../../../../stdlib/Stdlib/index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>decode_string'</code> is like <a href="#val-decode'"><code>decode'</code></a> but decodes directly from a string.</p></div></div><h2 id="encode"><a href="#encode" class="anchor"></a>Encode</h2><div class="odoc-spec"><div class="spec value anchored" id="val-encode"><a href="#val-encode" class="anchor"></a><code><span><span class="keyword">val</span> encode : 
  <span><span class="optlabel">?buf</span>:<a href="../../../bytesrw/Bytesrw/Bytes/index.html#type-t">Bytesrw.Bytes.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?format</span>:<a href="../../Jsont/index.html#type-format">Jsont.format</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?number_format</span>:<a href="../../Jsont/index.html#type-number_format">Jsont.number_format</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="../../Jsont/index.html#type-t">Jsont.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">eod</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../bytesrw/Bytesrw/Bytes/Writer/index.html#type-t">Bytesrw.Bytes.Writer.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(unit, string)</span> <a href="../../../../stdlib/Stdlib/index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>encode t v w</code> encodes value <code>v</code> according to <code>t</code> on <code>w</code>.</p><ul><li>If <code>buf</code> is specified it is used as a buffer for the slices written on <code>w</code>. Defaults to a buffer of length <code>Bytes.Writer.slice_length</code><code> w</code>.</li><li><code>format</code> specifies how the JSON should be formatted. Defaults to <a href="../../Jsont/index.html#type-format.Minify"><code>Jsont.format.Minify</code></a>.</li><li><code>number_format</code> specifies the format string to format numbers. Defaults to <a href="../../Jsont/index.html#val-default_number_format"><code>Jsont.default_number_format</code></a>.</li><li><code>eod</code> indicates whether <a href="../../../bytesrw/Bytesrw/Bytes/Slice/index.html#val-eod"><code>Bytesrw.Bytes.Slice.eod</code></a> should be written on <code>w</code>.</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-encode'"><a href="#val-encode'" class="anchor"></a><code><span><span class="keyword">val</span> encode' : 
  <span><span class="optlabel">?buf</span>:<a href="../../../bytesrw/Bytesrw/Bytes/index.html#type-t">Bytesrw.Bytes.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?format</span>:<a href="../../Jsont/index.html#type-format">Jsont.format</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?number_format</span>:<a href="../../Jsont/index.html#type-number_format">Jsont.number_format</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="../../Jsont/index.html#type-t">Jsont.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">eod</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../bytesrw/Bytesrw/Bytes/Writer/index.html#type-t">Bytesrw.Bytes.Writer.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(unit, <a href="../../Jsont/Error/index.html#type-t">Jsont.Error.t</a>)</span> <a href="../../../../stdlib/Stdlib/index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>encode'</code> is like <a href="#val-encode"><code>encode</code></a> but preserves the error structure.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-encode_string"><a href="#val-encode_string" class="anchor"></a><code><span><span class="keyword">val</span> encode_string : 
  <span><span class="optlabel">?buf</span>:<a href="../../../bytesrw/Bytesrw/Bytes/index.html#type-t">Bytesrw.Bytes.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?format</span>:<a href="../../Jsont/index.html#type-format">Jsont.format</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?number_format</span>:<a href="../../Jsont/index.html#type-number_format">Jsont.number_format</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="../../Jsont/index.html#type-t">Jsont.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(string, string)</span> <a href="../../../../stdlib/Stdlib/index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>encode_string</code> is like <a href="#val-encode"><code>encode</code></a> but writes to a string.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-encode_string'"><a href="#val-encode_string'" class="anchor"></a><code><span><span class="keyword">val</span> encode_string' : 
  <span><span class="optlabel">?buf</span>:<a href="../../../bytesrw/Bytesrw/Bytes/index.html#type-t">Bytesrw.Bytes.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?format</span>:<a href="../../Jsont/index.html#type-format">Jsont.format</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?number_format</span>:<a href="../../Jsont/index.html#type-number_format">Jsont.number_format</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="../../Jsont/index.html#type-t">Jsont.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(string, <a href="../../Jsont/Error/index.html#type-t">Jsont.Error.t</a>)</span> <a href="../../../../stdlib/Stdlib/index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>encode_string'</code> is like <a href="#val-encode'"><code>encode'</code></a> but writes to a string.</p></div></div><h2 id="recode"><a href="#recode" class="anchor"></a>Recode</h2><p>The defaults in these functions are those of <a href="#val-decode"><code>decode</code></a> and <a href="#val-encode"><code>encode</code></a>, except if <code>layout</code> is <code>true</code>, <code>format</code> defaults to <code>Jsont.Layout</code> and vice-versa.</p><div class="odoc-spec"><div class="spec value anchored" id="val-recode"><a href="#val-recode" class="anchor"></a><code><span><span class="keyword">val</span> recode : 
  <span><span class="optlabel">?layout</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?locs</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?file</span>:<a href="../../Jsont/Textloc/index.html#type-fpath">Jsont.Textloc.fpath</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?buf</span>:<a href="../../../bytesrw/Bytesrw/Bytes/index.html#type-t">Bytesrw.Bytes.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?format</span>:<a href="../../Jsont/index.html#type-format">Jsont.format</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?number_format</span>:<a href="../../Jsont/index.html#type-number_format">Jsont.number_format</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="../../Jsont/index.html#type-t">Jsont.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../bytesrw/Bytesrw/Bytes/Reader/index.html#type-t">Bytesrw.Bytes.Reader.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../bytesrw/Bytesrw/Bytes/Writer/index.html#type-t">Bytesrw.Bytes.Writer.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">eod</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span>(unit, string)</span> <a href="../../../../stdlib/Stdlib/index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>recode</code> is <a href="#val-decode"><code>decode</code></a> followed by <a href="#val-recode"><code>recode</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-recode'"><a href="#val-recode'" class="anchor"></a><code><span><span class="keyword">val</span> recode' : 
  <span><span class="optlabel">?layout</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?locs</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?file</span>:<a href="../../Jsont/Textloc/index.html#type-fpath">Jsont.Textloc.fpath</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?buf</span>:<a href="../../../bytesrw/Bytesrw/Bytes/index.html#type-t">Bytesrw.Bytes.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?format</span>:<a href="../../Jsont/index.html#type-format">Jsont.format</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?number_format</span>:<a href="../../Jsont/index.html#type-number_format">Jsont.number_format</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="../../Jsont/index.html#type-t">Jsont.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../bytesrw/Bytesrw/Bytes/Reader/index.html#type-t">Bytesrw.Bytes.Reader.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../bytesrw/Bytesrw/Bytes/Writer/index.html#type-t">Bytesrw.Bytes.Writer.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">eod</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span>(unit, <a href="../../Jsont/Error/index.html#type-t">Jsont.Error.t</a>)</span> <a href="../../../../stdlib/Stdlib/index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>recode'</code> is like <a href="#val-recode"><code>recode</code></a> but preserves the error structure.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-recode_string"><a href="#val-recode_string" class="anchor"></a><code><span><span class="keyword">val</span> recode_string : 
  <span><span class="optlabel">?layout</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?locs</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?file</span>:<a href="../../Jsont/Textloc/index.html#type-fpath">Jsont.Textloc.fpath</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?buf</span>:<a href="../../../bytesrw/Bytesrw/Bytes/index.html#type-t">Bytesrw.Bytes.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?format</span>:<a href="../../Jsont/index.html#type-format">Jsont.format</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?number_format</span>:<a href="../../Jsont/index.html#type-number_format">Jsont.number_format</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="../../Jsont/index.html#type-t">Jsont.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span>(string, string)</span> <a href="../../../../stdlib/Stdlib/index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>recode</code> is <a href="#val-decode_string"><code>decode_string</code></a> followed by <a href="#val-recode_string"><code>recode_string</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-recode_string'"><a href="#val-recode_string'" class="anchor"></a><code><span><span class="keyword">val</span> recode_string' : 
  <span><span class="optlabel">?layout</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?locs</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?file</span>:<a href="../../Jsont/Textloc/index.html#type-fpath">Jsont.Textloc.fpath</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?buf</span>:<a href="../../../bytesrw/Bytesrw/Bytes/index.html#type-t">Bytesrw.Bytes.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?format</span>:<a href="../../Jsont/index.html#type-format">Jsont.format</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?number_format</span>:<a href="../../Jsont/index.html#type-number_format">Jsont.number_format</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="../../Jsont/index.html#type-t">Jsont.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span>(string, <a href="../../Jsont/Error/index.html#type-t">Jsont.Error.t</a>)</span> <a href="../../../../stdlib/Stdlib/index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>recode_string'</code> is like <a href="#val-recode_string"><code>recode_string</code></a> but preserves the error structure.</p></div></div><h2 id="layout"><a href="#layout" class="anchor"></a>Layout preservation</h2><p>In order to simplify the implementation not all layout is preserved. In particular:</p><ul><li>White space in empty arrays and objects is dropped.</li><li>Unicode escapes are replaced by their UTF-8 encoding.</li><li>The format of numbers is not preserved.</li></ul><h2 id="duplicate"><a href="#duplicate" class="anchor"></a>Duplicate object members</h2><p>Duplicate object members are undefined behaviour in JSON. We follow the behaviour of <a href="https://262.ecma-international.org/6.0/#sec-internalizejsonproperty"><code>JSON.parse</code></a> and the last one takes over, however duplicate members all have to parse with the specified type as we error as soon as possible. Also <a href="../../Jsont/Object/index.html#val-case_mem" title="Jsont.Object.case_mem">case members</a> are not allowed to duplicate.</p></div></body></html>
