<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Writer (docs.findlib-1.bytesrw.Bytesrw.Bytes.Writer)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../../../../index.html">Index</a> &#x00BB; <a href="../../../../../index.html">docs</a> &#x00BB; <a href="../../../../index.html">findlib-1</a> &#x00BB; <a href="../../../index.html">bytesrw</a> &#x00BB; <a href="../../index.html">Bytesrw</a> &#x00BB; <a href="../index.html">Bytes</a> &#x00BB; Writer</nav><header class="odoc-preamble"><h1>Module <code><span>Bytes.Writer</span></code></h1><p>Byte stream writers.</p><p>Byte streams are sequences of non-empty <a href="../Slice/index.html" title="Slice">byte slices</a> ended by a single <a href="../Slice/index.html#val-eod"><code>Slice.eod</code></a> slice. A byte stream writer is given access to these slices in order but only slice by slice in its write function: the slice only remains <a href="../Slice/index.html#validity" title="validity">valid for reading</a> until the write function returns.</p><p>See the <span class="xref-unresolved" title="index.quick">quick start</span> and read more about stream writers in the <span class="xref-unresolved" title="tutorial.writers">tutorial</span>.</p></header><div class="odoc-tocs"><nav class="odoc-toc odoc-local-toc"><ul><li><a href="#writers">Writers</a></li><li><a href="#writing">Writing</a></li><li><a href="#filters">Filters</a></li><li><a href="#taps">Taps</a></li><li><a href="#convert">Converting</a></li><li><a href="#fmt">Formatting and inspecting</a></li></ul></nav></div><div class="odoc-content"><h2 id="writers"><a href="#writers" class="anchor"></a>Writers</h2><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>The type for byte stream writers.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-make"><a href="#val-make" class="anchor"></a><code><span><span class="keyword">val</span> make : 
  <span><span class="optlabel">?pos</span>:<a href="../Stream/index.html#type-pos">Stream.pos</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?slice_length</span>:<a href="../Slice/index.html#type-length">Slice.length</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><a href="../Slice/index.html#type-t">Slice.t</a> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>make write</code> is a writer from the function <code>write</code> which iterates over the slices of a byte stream. The contract between the writer and <code>write</code> is as follows:</p><ul><li>The slice values given to <code>write</code> are <a href="../Slice/index.html#validity" title="validity">valid for reading</a> only until the <code>write</code> function returns.</li><li>The writer guarantees that after <code>write</code> was called with <a href="../Slice/index.html#val-eod"><code>Slice.eod</code></a>, <code>write</code> is dereferenced by the writer and will never be called again.</li></ul><p><code>pos</code> defaults to <code>0</code> and slice_length to <a href="../Slice/index.html#val-default_length"><code>Slice.default_length</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-ignore"><a href="#val-ignore" class="anchor"></a><code><span><span class="keyword">val</span> ignore : <span><span class="optlabel">?pos</span>:<a href="../Stream/index.html#type-pos">Stream.pos</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="optlabel">?slice_length</span>:<a href="../Slice/index.html#type-length">Slice.length</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>ignore ()</code> is <code>make (fun _ -&gt; ())</code>, a writer that ignores the writes that are pushed on it.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pos"><a href="#val-pos" class="anchor"></a><code><span><span class="keyword">val</span> pos : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Stream/index.html#type-pos">Stream.pos</a></span></code></div><div class="spec-doc"><p><code>pos w</code> is the <a href="../Stream/index.html#type-pos" title="Stream.pos">stream position</a> of the next byte to write. Alternatively it can be seen as the number of bytes written on <code>w</code>, see <a href="#val-written_length"><code>written_length</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-slice_length"><a href="#val-slice_length" class="anchor"></a><code><span><span class="keyword">val</span> slice_length : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Slice/index.html#type-length">Slice.length</a></span></code></div><div class="spec-doc"><p><code>slice_length w</code> is a hint on the maximal length of slices that <code>w</code> would like to receive.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-written_length"><a href="#val-written_length" class="anchor"></a><code><span><span class="keyword">val</span> written_length : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>written_length w</code> is an alternative name for <a href="#val-pos"><code>pos</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-error"><a href="#val-error" class="anchor"></a><code><span><span class="keyword">val</span> error : <span><span><span class="type-var">'e</span> <a href="../Stream/index.html#type-format_error">Stream.format_error</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="optlabel">?pos</span>:<a href="../Stream/index.html#type-pos">Stream.pos</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'e</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>error fmt w e</code> raises a <a href="../Stream/index.html#exception-Error"><code>Stream.Error</code></a> <code>e</code> of format <code>fmt</code> for <code>w</code>. <code>pos</code> is the position reported for the error it defaults to <code>w</code>'s <a href="#val-pos"><code>pos</code></a>. If the value is negative it is added to the latter, e.g. using the negated length of the last slice would report an error at the first byte of the last slice.</p></div></div><h2 id="writing"><a href="#writing" class="anchor"></a>Writing</h2><p><b>Note.</b> All these functions raise <code>Invalid_argument</code> if a slice other than <a href="../Slice/index.html#val-eod"><code>Slice.eod</code></a> is written after a <a href="../Slice/index.html#val-eod"><code>Slice.eod</code></a> was written.</p><div class="odoc-spec"><div class="spec value anchored" id="val-write"><a href="#val-write" class="anchor"></a><code><span><span class="keyword">val</span> write : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Slice/index.html#type-t">Slice.t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>write w s</code> writes the slice <code>s</code> on <code>w</code>. The slice <code>s</code> must remain <a href="../Slice/index.html#validity" title="validity">valid for reading</a> until the function returns.</p><p>The function raises <code>Invalid_argument</code> is <code>s</code> is written after a <a href="../Slice/index.html#val-eod"><code>Slice.eod</code></a> and <code>s</code> is not <a href="../Slice/index.html#val-eod"><code>Slice.eod</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-write_eod"><a href="#val-write_eod" class="anchor"></a><code><span><span class="keyword">val</span> write_eod : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>write_eod w</code> is <code>write w Slice.eod</code>. Only <a href="../Slice/index.html#val-eod"><code>Slice.eod</code></a> can be written on <code>w</code> aftewards.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-write_bytes"><a href="#val-write_bytes" class="anchor"></a><code><span><span class="keyword">val</span> write_bytes : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>bytes <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>write_bytes w b</code> writes the bytes <code>b</code> on <code>w</code> in <a href="#val-slice_length"><code>slice_length</code></a> slices, except perhaps the last one. The bytes of <code>b</code> must not change until the function returns.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-write_string"><a href="#val-write_string" class="anchor"></a><code><span><span class="keyword">val</span> write_string : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>write_string</code> is like <a href="#val-write_bytes"><code>write_bytes</code></a> but writes a string.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-write_reader"><a href="#val-write_reader" class="anchor"></a><code><span><span class="keyword">val</span> write_reader : <span><span class="label">eod</span>:bool <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Reader/index.html#type-t">Reader.t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>write_reader w r</code> writes the slices of <code>r</code> on <code>w</code>. <a href="../Slice/index.html#val-eod"><code>Slice.eod</code></a> is only written if <code>eod</code> is <code>true</code>. Note that the slices are written as given by <code>r</code> and may not respect <code>w</code>'s desired <a href="#val-slice_length"><code>slice_length</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-write_in_channel"><a href="#val-write_in_channel" class="anchor"></a><code><span><span class="keyword">val</span> write_in_channel : <span><span class="label">eod</span>:bool <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../../stdlib/Stdlib/In_channel/index.html#type-t">In_channel.t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>write_in_channel w ic</code> sets <code>ic</code> to <a href="../../../../../stdlib/Stdlib/In_channel/index.html#val-set_binary_mode" title="In_channel.set_binary_mode">binary mode</a> and writes slices to <code>w</code> until the end of file is reached at which point <a href="../Slice/index.html#val-eod"><code>Slice.eod</code></a> is written iff <code>eod</code> is true. The maximal length of written slices are <code>w</code>'s <a href="#val-slice_length"><code>slice_length</code></a>.</p></div></div><h2 id="filters"><a href="#filters" class="anchor"></a>Filters</h2><p>Read more about filters in the <span class="xref-unresolved" title="tutorial.writer_filters">tutorial</span>.</p><div class="odoc-spec"><div class="spec type anchored" id="type-filter"><a href="#type-filter" class="anchor"></a><code><span><span class="keyword">type</span> filter</span><span> =
  <span><span class="optlabel">?pos</span>:<a href="../Stream/index.html#type-pos">Stream.pos</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?slice_length</span>:<a href="../Slice/index.html#type-length">Slice.length</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">eod</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>The type for byte stream writer filters.</p><p>Given a writer <code>w</code>, a filter <code>f</code> returns a filtering writer <code>f ~eod w</code>, that transforms the writes made on it in some way and then writes them to <code>w</code>. The following conventions should be followed for the filtering writer:</p><ul><li>Once the filter writer receives <a href="../Slice/index.html#val-eod"><code>Slice.eod</code></a>, it must stop and, if applicable, report an error if there was leftover data that it couldn't write. It must only write <a href="../Slice/index.html#val-eod"><code>Slice.eod</code></a> on <code>w</code> if <code>eod</code> is <code>true</code>. Otherwise it should leave <code>w</code> as is so that <code>w</code> can be used again to perform other non-filtered writes.</li><li>If <code>pos</code> is unspecified it should default to <code>w</code>'s position only if the writes are in the same position space as <code>w</code>. Otherwise it should be <code>0</code> (e.g. on compression filters).</li><li>If <code>slice_length</code> is unspecified it should default to <code>w</code>'s value or a value that makes more sense for the filter's needs.</li><li>The filtering writer should write slices on <code>w</code> that respects its <code>slice_length</code> desires.</li><li>If your filter is in a module <code>M</code>, then its name should be <code>M.{decode,encode}_writes</code> or an other meaningful verb like <code>M.{decompress,compress}_writes</code>, <code>M.{encrypt,decrypt}_writes</code>, etc.</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-limit"><a href="#val-limit" class="anchor"></a><code><span><span class="keyword">val</span> limit : <span><span class="optlabel">?action</span>:<span>(<span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <a href="#type-filter">filter</a></span></code></div><div class="spec-doc"><p><code>limit n w ~eod</code> is a writer that writes <em>at most</em> <code>n</code> bytes on <code>w</code>. Any leftover in the slice that exceeds the <code>n</code> bytes is lost. If the <code>n</code> bytes are exceeded, <a href="../Slice/index.html#val-eod"><code>Slice.eod</code></a> is written if <code>eod</code> is <code>true</code>, the action <code>action</code> is invoked once and the filtering writer accepts only <a href="../Slice/index.html#val-eod"><code>Slice.eod</code></a> afterwards. As per filter semantics <a href="../Slice/index.html#val-eod"><code>Slice.eod</code></a> is only written on <code>w</code> if <code>eod</code> is true. The default <code>action</code> raises <a href="../Stream/index.html#extension-Limit"><code>Stream.Limit</code></a> error.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-filter_string"><a href="#val-filter_string" class="anchor"></a><code><span><span class="keyword">val</span> filter_string : <span><span><a href="#type-filter">filter</a> list</span> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p><code>filter_string fs s</code> is a convenience function that applies the filters <code>fs</code>, from left to right to the string <code>s</code> it is equivalent to:</p><pre class="language-ocaml"><code>  let b = Buffer.create (String.length s) in
  let w = List.fold_left (fun w f -&gt; f ~eod:true w) (of_buffer w) fs in
  write_string w s; write_eod w; Buffer.contents b</code></pre><p>See an <span class="xref-unresolved" title="cookbook.string_filtering">example</span>.</p></div></div><h2 id="taps"><a href="#taps" class="anchor"></a>Taps</h2><div class="odoc-spec"><div class="spec value anchored" id="val-tap"><a href="#val-tap" class="anchor"></a><code><span><span class="keyword">val</span> tap : <span><span>(<span><a href="../Slice/index.html#type-t">Slice.t</a> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>tap f w</code> is a writer that invokes <code>f</code> with the slice before writing it on <code>w</code>. See also <a href="../Slice/index.html#val-tracer"><code>Slice.tracer</code></a> and <span class="xref-unresolved" title="cookbook.tracing">an example</span>.</p></div></div><h2 id="convert"><a href="#convert" class="anchor"></a>Converting</h2><div class="odoc-spec"><div class="spec value anchored" id="val-of_out_channel"><a href="#val-of_out_channel" class="anchor"></a><code><span><span class="keyword">val</span> of_out_channel : 
  <span><span class="optlabel">?pos</span>:<a href="../Stream/index.html#type-pos">Stream.pos</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?slice_length</span>:<a href="../Slice/index.html#type-length">Slice.length</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?flush_slices</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../../../stdlib/Stdlib/Out_channel/index.html#type-t">Out_channel.t</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>of_out_channel oc</code> sets <code>oc</code> to binary mode and writes slices to <code>oc</code>. If <code>flush_slices</code> is <code>true</code> (defaults to <code>false</code>), <code>oc</code> is <a href="../../../../../stdlib/Stdlib/Out_channel/index.html#val-flush" title="Out_channel.flush">flushed</a> after each slice except <a href="../Slice/index.html#val-eod"><code>Slice.eod</code></a>. <code>pos</code> defaults to <a href="../../../../../stdlib/Stdlib/Out_channel/index.html#val-pos"><code>Out_channel.pos</code></a>. The hinted <a href="#val-slice_length"><code>slice_length</code></a> defaults to <a href="../Slice/index.html#val-io_buffer_size"><code>Slice.io_buffer_size</code></a>. This function and the resulting writer may raise <code>Sys_error</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-of_buffer"><a href="#val-of_buffer" class="anchor"></a><code><span><span class="keyword">val</span> of_buffer : <span><span class="optlabel">?pos</span>:<a href="../Stream/index.html#type-pos">Stream.pos</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="optlabel">?slice_length</span>:<a href="../Slice/index.html#type-length">Slice.length</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../../stdlib/Stdlib/Buffer/index.html#type-t">Buffer.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>of_buffer b</code> writes slices to <code>b</code>.</p><p><code>slice_length</code> is not that important but we default it to <a href="../Slice/index.html#val-io_buffer_size"><code>Slice.io_buffer_size</code></a>, so that channel and fd readers that may ajust their own buffers on writers adjust nicely for themselves.</p></div></div><h2 id="fmt"><a href="#fmt" class="anchor"></a>Formatting and inspecting</h2><div class="odoc-spec"><div class="spec value anchored" id="val-pp"><a href="#val-pp" class="anchor"></a><code><span><span class="keyword">val</span> pp : <span><a href="../../../../../stdlib/Stdlib/Format/index.html#type-formatter">Format.formatter</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>pp</code> formats a writer's properties for inspection.</p></div></div></div></body></html>
